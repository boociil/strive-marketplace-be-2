generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "darwin-arm64"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Users {
  id               Int       @id @default(autoincrement())
  email            String    @unique
  password         String
  firstName        String
  lastName         String
  role             Int       @default(1)
  telp             String    @default("")
  buka_toko        Int       @default(0)
  nama_toko        String    @default("")
  path_foto_toko   String    @default("")
  klasifikasi_toko Int       @default(0)
  rating_toko      Float     @default(0)
  gender           Int       @default(0)
  acc_by           Int?
  status_pengajuan Int       @default(0)
  time_terima      DateTime?
  time_pengajuan   DateTime?
  path_file        String    @default("")
  tanggal_lahir    DateTime?
  ktp_path         String?
  an_rek           String    @default("")
  rek_toko         String    @default("")
  alamat           Alamat[]  @relation("AlamatUser")
  product          Product[]
}

model Product {
  id       Int    @id @default(autoincrement())
  userId   Int
  nama     String
  desc     String
  path     String
  kategori Int    @default(0)
  harga    Int    @default(0)
  user     Users  @relation(fields: [userId], references: [id])
}

model Alamat {
  id         Int       @id @default(autoincrement())
  userId     Int
  detail     String    @default("")
  is_default Int       @default(0)
  is_toko    Int       @default(0)
  kodeDesa   String
  kodeKab    String
  kodeKec    String
  kodeProv   String
  kodePos    String
  bangunan   String    @default("")
  nama       String    @default("")
  notelp     String    @default("")
  provinsi   Provinsi  @relation(fields: [kodeProv], references: [kode])
  kabupaten  Kabupaten @relation(fields: [kodeProv, kodeKab], references: [kodeProv, kode])
  kecamatan  Kecamatan @relation(fields: [kodeProv, kodeKab, kodeKec], references: [kodeProv, kodeKab, kode])
  desa       Desa      @relation(fields: [kodeProv, kodeKab, kodeKec, kodeDesa], references: [kodeProv, kodeKab, kodeKec, kode])
  users      Users     @relation("AlamatUser", fields: [userId], references: [id])
}

model Provinsi {
  kode      String      @id
  nama      String
  alamat    Alamat[]
  kabupaten Kabupaten[]
}

model Kabupaten {
  kodeProv  String
  kode      String
  nama      String
  alamat    Alamat[]
  provinsi  Provinsi    @relation(fields: [kodeProv], references: [kode])
  kecamatan Kecamatan[]

  @@id([kodeProv, kode])
}

model Kecamatan {
  kodeProv  String
  kodeKab   String
  kode      String
  nama      String
  alamat    Alamat[]
  desa      Desa[]
  kabupaten Kabupaten @relation(fields: [kodeProv, kodeKab], references: [kodeProv, kode])

  @@id([kodeProv, kodeKab, kode])
}

model Desa {
  kodeProv  String
  kodeKab   String
  kodeKec   String
  kode      String
  nama      String
  alamat    Alamat[]
  kecamatan Kecamatan @relation(fields: [kodeProv, kodeKab, kodeKec], references: [kodeProv, kodeKab, kode])

  @@id([kodeProv, kodeKab, kodeKec, kode])
}
